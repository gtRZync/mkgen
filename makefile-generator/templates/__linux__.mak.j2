# --------------------------------------------------
# This Makefile was auto-generated using mkgen
#
# mkgen is a simple Makefile generator for C and C++ projects
# designed to remove the pain of manual compilation and linking.
#
# Home page : https://github.com/gtRZync
# Documentation : https://github.com/gtRZync/mkgen.git
# Author : Myson Dio
#
# You can safely regenerate this file at any time.
# Manual edits may be overwritten.(for now)
# --------------------------------------------------

.PHONY: clean run $(BIN_DIR) $(BUILD_DIR) all bear

MODE ?= release
VERBOSE ?= 0


{{ compiler.var }} := {{ compiler.name }}
{{compiler.var}}FLAGS = -std={{compiler.std}} -Wall -Werror -I$(INCLUDE_DIR)
ifeq ($(MODE), debug)
    {{compiler.var}}FLAGS += -g -DDEBUG
else
    {{compiler.var}}FLAGS += -O2 -s -DNDEBUG
endif

{% if use_gui_lib %}
LIBS = {{ gui_lib_flags }}
{{compiler.var}}FLAGS += {{ gui_lib_cflags}}
{% endif %}

ifeq ($(VERBOSE), 1)
    Q := 
else
    Q := @
endif

BIN_DIR := {{ directories.bin }}
SOURCE_DIR := {{ directories.src | default('.') }}
BUILD_DIR := {{ directories.build }}
INCLUDE_DIR := {{ directories.include }}
OUT := $(BIN_DIR)/{{ output_file }}

SRCS := $(wildcard $(SOURCE_DIR)/*{{src_ext}})
OBJS := $(patsubst $(SOURCE_DIR)/%{{src_ext}}, $(BUILD_DIR)/%.o, $(SRCS))
ENSURE_BIN := mkdir -p $(BIN_DIR)
ENSURE_BUILD := mkdir -p $(BUILD_DIR)
RUN_CMD := ./$(OUT)
DONE := echo Build complete for Linux

all: $(OUT)
	$(Q)$(DONE)

$(BUILD_DIR)/%.o: $(SOURCE_DIR)/%{{src_ext}} | $(BUILD_DIR)
	$(Q)echo "Compiling $<"
	$(Q)$({{compiler.var}}) $({{compiler.var}}FLAGS) -c -o $@ $<

$(OUT): $(OBJS) | $(BIN_DIR)
	$(Q)echo "Compiling $(OBJS)"
	$(Q)$({{compiler.var}}) -o $@ $^ $({{compiler.var}}FLAGS) {% if use_gui_lib %} $(LIBS) {% endif %}

run: $(OUT)
	$(Q)$(DONE)
	$(Q)$(RUN_CMD)
	
$(BUILD_DIR):
	$(Q)$(ENSURE_BUILD)

$(BIN_DIR):
	$(Q)$(ENSURE_BIN)

clean:
	$(Q)echo "Executing clean command"
	$(Q)$(CLEAN)
	
bear:
	$(Q)bear -- make
